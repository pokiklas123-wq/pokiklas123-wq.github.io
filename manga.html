
<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO الأساسي -->
    <title>تفاصيل المانجا | جديد المانجا - أفضل موقع لقراءة المانجا العربية</title>
    <meta name="description" content="اقرأ أفضل المانجا العربية والمانغا المترجمة مجاناً على موقع جديد المانجا. آلاف السلاسل المصورة بتحديث يومي.">
    <meta name="keywords" content="مانجا, مانغا, قراءة مانجا, مانجا عربية, manga arabic, قصص مصورة">
    <meta name="author" content="جديد المانجا">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="googlebar" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="تفاصيل المانجا | جديد المانجا">
    <meta property="og:description" content="اقرأ أفضل المانجا العربية والمانغا المترجمة مجاناً على موقع جديد المانجا">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://pokiklas123-wq.github.io/manga.html">
    <meta property="og:image" content="https://pokiklas123-wq.github.io/images/og-image.jpg">
    <meta property="og:site_name" content="جديد المانجا">
    
    <!-- Canonical URL -->
    <!-- يجب تحديث هذا الرابط ديناميكياً ليعكس صفحة المانجا الفعلية -->
    <link rel="canonical" href="https://pokiklas123-wq.github.io/manga.html">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": "قراءة المانجا العربية مجاناً على موقع جديد المانجا",
        "description": "استمتع بقراءة أفضل المانجا العربية والمانغا المترجمة على موقع جديد المانجا",
        "author": {
            "@type": "Organization",
            "name": "جديد المانجا"
        },
        "publisher": {
            "@type": "Organization",
            "name": "جديد المانجا",
            "logo": {
                "@type": "ImageObject",
                "url": "https://pokiklas123-wq.github.io/images/logo.png"
            }
        },
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://pokiklas123-wq.github.io/manga.html"
        }
    }
    </script>
    
    <title>تفاصيل المانجا</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/style.css">
    
    <style>
        /* تنسيق الشعار */
        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            color: inherit;
        }

        .logo-img {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
        }

        .logo-text {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        @media (max-width: 768px) {
            .logo-img {
                width: 32px;
                height: 32px;
            }
            .logo-text {
                font-size: 1rem;
            }
        }

        .manga-detail {
            margin-bottom: 2rem;
        }
        .manga-header {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        .manga-poster {
            flex: 0 0 300px;
        }
        .manga-poster img {
            width: 100%;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }
        .manga-info-large {
            flex: 1;
        }
        .manga-title-large {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--text-color);
        }
        .manga-meta-large {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--card-bg);
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
        }
        .manga-description {
            line-height: 1.6;
            margin-bottom: 1.5rem;
            color: var(--text-color);
        }
        
        /* أنماط نظام التقييم */
        .rating-section {
            margin: 1.5rem 0;
            padding: 1rem;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
        }
        
        .star-rating {
            display: flex;
            gap: 0.5rem;
            margin: 0.5rem 0;
            direction: ltr;
        }
        
        .star-rating i {
            font-size: 1.5rem;
            color: var(--border-color);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .star-rating i:hover {
            transform: scale(1.2);
            color: #ffc107;
        }
        
        .star-rating i.active {
            color: #ffc107;
        }
        
        .rating-text, .average-rating {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-color);
        }
        
        .average-rating {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }
        
        .chapters-section {
            margin-top: 2rem;
        }
        .chapters-list {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        .chapter-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }
        .chapter-item:hover {
            background: var(--hover-color);
        }
        .chapter-item:last-child {
            border-bottom: none;
        }
        .chapter-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .chapter-number {
            font-weight: bold;
            color: var(--primary-color);
        }
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: var(--border-color);
        }
        .mt-2 {
            margin-top: 1rem;
        }

        /* أنماط الظيالوغ (Toast Notification) */
        .toast-container {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 400px;
            width: 90%;
        }

        .toast {
            background: var(--card-bg);
            border: 2px solid var(--primary-color);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            animation: toastSlideIn 0.3s ease-out;
            position: relative;
            backdrop-filter: blur(10px);
        }

        .toast.success {
            border-color: #27ae60;
            background: linear-gradient(135deg, var(--card-bg), rgba(39, 174, 96, 0.1));
        }

        .toast-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .toast-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .toast-title {
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--text-color);
            margin: 0;
        }

        .toast-body {
            margin-bottom: 1.5rem;
        }

        .toast-manga-name {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .toast-rating-stars {
            display: flex;
            gap: 0.25rem;
            margin: 0.5rem 0;
            direction: ltr;
        }

        .toast-rating-stars i {
            color: #ffc107;
            font-size: 1.1rem;
        }

        .toast-rating-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.75rem;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .toast-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }

        .toast-btn {
            padding: 0.5rem 1.5rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .toast-btn-close {
            background: var(--primary-color);
            color: white;
        }

        .toast-btn-close:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }

        .toast-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 0 0 12px 12px;
            animation: toastProgress 3s linear forwards;
        }

        @keyframes toastSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes toastSlideOut {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(-30px);
            }
        }

        @keyframes toastProgress {
            from {
                width: 100%;
            }
            to {
                width: 0%;
            }
        }

        .toast.hiding {
            animation: toastSlideOut 0.3s ease-in forwards;
        }

        /* تخصيص الظيالوغ حسب الثيم */
        [data-theme="dark"] .toast {
            background: linear-gradient(135deg, #2d3748, #1a202c);
            border-color: #4a5568;
        }

        [data-theme="dark"] .toast.success {
            border-color: #27ae60;
            background: linear-gradient(135deg, #2d3748, rgba(39, 174, 96, 0.2));
        }

        [data-theme="blue"] .toast {
            background: linear-gradient(135deg, #ebf8ff, #bee3f8);
            border-color: #3182ce;
        }

        [data-theme="blue"] .toast.success {
            border-color: #27ae60;
            background: linear-gradient(135deg, #ebf8ff, rgba(39, 174, 96, 0.15));
        }

        [data-theme="blue"] .toast-title,
        [data-theme="blue"] .toast-body {
            color: #2d3748;
        }

        @media (max-width: 768px) {
            .manga-header {
                flex-direction: column;
            }
            .manga-poster {
                flex: none;
                max-width: 250px;
                margin: 0 auto;
            }
            .manga-meta-large {
                justify-content: center;
            }
            .meta-item {
                font-size: 0.9rem;
                padding: 0.4rem 0.8rem;
            }
            
            .toast-container {
                top: 80px;
                width: 95%;
            }
            
            .toast {
                padding: 1rem;
            }
            
            .toast-header {
                gap: 0.5rem;
            }
            
            .toast-icon {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <button id="drawerToggle" class="btn btn-outline">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- شعار الموقع -->
        <a href="index.html" class="logo">
            <img src="images/logo.png" alt="جديد المانجا - موقع المانجا العربية" class="logo-img">
            <span class="logo-text">جديد المانجا</span>
        </a>
        
        <div class="header-actions">
            <button id="notificationsBtn" class="btn btn-outline">
                <i class="fas fa-bell"></i>
                <span class="notification-badge hidden"></span>
            </button>
            <button id="authBtn" class="btn">
                <i class="fas fa-user"></i>
                <span>تسجيل الدخول</span>
            </button>
        </div>
    </header>

    <!-- Drawer -->
    <div class="drawer">
        <div class="drawer-header">
            <h2 class="drawer-title">القائمة</h2>
            <button class="drawer-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div id="userInfo" class="user-info hidden">
            <img src="" alt="صورة المستخدم" class="user-avatar">
            <div class="user-details">
                <div class="user-name"></div>
                <div class="user-email"></div>
            </div>
        </div>
        
        <ul class="drawer-menu">
            <li class="drawer-menu-item">
                <a href="index.html" class="drawer-menu-link">
                    <i class="fas fa-home"></i>
                    <span>الصفحة الرئيسية</span>
                </a>
            </li>
           
            <li class="drawer-menu-item">
                <a href="notifications.html" class="drawer-menu-link" id="notificationsDrawerBtn">
                    <i class="fas fa-bell"></i>
                    <span>الإشعارات</span>
                </a>
            </li>
        </ul>
        
        <!-- قسم الثيمات المعدل -->
        <div class="theme-selector">
            <span>المظهر:</span>
            <div class="theme-options">
                <div class="theme-option active" data-theme="dark">
                    <i class="fas fa-moon"></i>
                    <span>أسود</span>
                </div>
                <div class="theme-option" data-theme="blue">
                    <i class="fas fa-palette"></i>
                    <span>أزرق</span>
                </div>
            </div>
        </div>
        
        <button id="logoutBtn" class="btn btn-outline hidden">
            <i class="fas fa-sign-out-alt"></i>
            تسجيل الخروج
        </button>
    </div>
    <div class="drawer-overlay"></div>

    <!-- حاوية الظيالوغ -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Main Content -->
    <div class="container">
        <div id="mangaDetail" class="manga-detail">
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </div>
    </div>

    <script src="js/firebase-config.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="js/ui.js"></script>
     <script src="js/utils.js"></script>
    <script src="js/app.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/manga.js"></script>

    <!-- كود إدارة الظيالوغ -->
    <script>
        class ToastManager {
            constructor() {
                this.container = document.getElementById('toastContainer');
                this.toasts = new Set();
            }

            showRatingToast(mangaName, userRating, totalRatings, averageRating) {
                const toastId = 'toast-' + Date.now();
                const starsHTML = this.generateStarsHTML(userRating);
                
                const toastHTML = `
                    <div class="toast success" id="${toastId}">
                        <div class="toast-header">
                            <div class="toast-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <h3 class="toast-title">تم التقييم بنجاح!</h3>
                        </div>
                        <div class="toast-body">
                            <div class="toast-manga-name">${mangaName}</div>
                            <div class="toast-rating-stars">
                                ${starsHTML}
                            </div>
                            <div class="toast-rating-info">
                                <span>تقييمك: ${userRating} نجوم</span>
                                <span>إجمالي التقييمات: ${totalRatings}</span>
                            </div>
                            <div class="toast-rating-info">
                                <span>المعدل: ${averageRating.toFixed(1)}</span>
                            </div>
                        </div>
                        <div class="toast-actions">
                            <button class="toast-btn toast-btn-close" onclick="toastManager.hide('${toastId}')">
                                تم
                            </button>
                        </div>
                        <div class="toast-progress"></div>
                    </div>
                `;

                this.container.insertAdjacentHTML('beforeend', toastHTML);
                const toast = document.getElementById(toastId);
                this.toasts.add(toastId);

                // إخفاء تلقائي بعد 5 ثواني
                setTimeout(() => {
                    this.hide(toastId);
                }, 5000);

                return toastId;
            }

            generateStarsHTML(rating) {
                let stars = '';
                for (let i = 1; i <= 5; i++) {
                    if (i <= rating) {
                        stars += '<i class="fas fa-star"></i>';
                    } else {
                        stars += '<i class="far fa-star"></i>';
                    }
                }
                return stars;
            }

            hide(toastId) {
                const toast = document.getElementById(toastId);
                if (toast) {
                    toast.classList.add('hiding');
                    setTimeout(() => {
                        toast.remove();
                        this.toasts.delete(toastId);
                    }, 300);
                }
            }

            hideAll() {
                this.toasts.forEach(toastId => {
                    this.hide(toastId);
                });
            }
        }

        // تهيئة مدير الظيالوغ
        const toastManager = new ToastManager();

        // دالة مساعدة لإظهار ظيالوغ التقييم
        function showRatingNotification(mangaName, userRating, totalRatings, averageRating) {
            return toastManager.showRatingToast(mangaName, userRating, totalRatings, averageRating);
        }

        // تعديل نظام النجوم الحالي لاستخدام الظيالوغ الجديد
        document.addEventListener('DOMContentLoaded', function() {
            // الانتظار حتى يتم تحميل محتوى المانجا
            setTimeout(() => {
                setupRatingSystem();
            }, 1000);
        });

        function setupRatingSystem() {
            // البحث عن نظام النجوم في الصفحة
            const starRatings = document.querySelectorAll('.star-rating');
            
            starRatings.forEach(stars => {
                // إزالة أي مستمعات قديمة
                stars.replaceWith(stars.cloneNode(true));
            });

            // إعادة الحصول على النجوم بعد الاستبدال
            const newStarRatings = document.querySelectorAll('.star-rating');
            
            newStarRatings.forEach(stars => {
                stars.addEventListener('click', function(e) {
                    if (e.target.classList.contains('fa-star')) {
                        const starsArray = Array.from(this.children);
                        const rating = starsArray.indexOf(e.target) + 1;
                        
                        // تحديث النجوم المرئية
                        starsArray.forEach((star, index) => {
                            if (index < rating) {
                                star.classList.add('active');
                                star.classList.remove('far');
                                star.classList.add('fas');
                            } else {
                                star.classList.remove('active');
                                star.classList.remove('fas');
                                star.classList.add('far');
                            }
                        });

                        // الحصول على بيانات المانجا
                        const mangaName = document.querySelector('.manga-title-large')?.textContent || 'المانجا';
                        
                        // محاكاة بيانات التقييم (يجب استبدالها بالبيانات الحقيقية من Firebase)
                        const totalRatingsElement = document.querySelector('.average-rating');
                        let totalRatings = 1;
                        let averageRating = rating;

                        if (totalRatingsElement) {
                            const ratingText = totalRatingsElement.textContent;
                            const matches = ratingText.match(/(\d+)/g);
                            if (matches && matches.length > 0) {
                                totalRatings = parseInt(matches[0]) + 1;
                                // حساب المعدل الجديد
                                const oldAverage = parseFloat(matches[1]) || rating;
                                averageRating = ((oldAverage * (totalRatings - 1)) + rating) / totalRatings;
                            }
                        }

                        // إظهار الظيالوغ الجديد
                        showRatingNotification(mangaName, rating, totalRatings, averageRating);

                        // هنا يمكنك إضافة كود حفظ التقييم في Firebase
                        console.log(`تم تقييم ${mangaName} بـ ${rating} نجوم`);
                    }
                });

                // إضافة تأثير Hover للنجوم
                stars.addEventListener('mouseover', function(e) {
                    if (e.target.classList.contains('fa-star')) {
                        const starsArray = Array.from(this.children);
                        const hoverRating = starsArray.indexOf(e.target) + 1;
                        
                        starsArray.forEach((star, index) => {
                            if (index < hoverRating) {
                                star.style.color = '#ffc107';
                            } else {
                                star.style.color = 'var(--border-color)';
                            }
                        });
                    }
                });

                stars.addEventListener('mouseout', function(e) {
                    const starsArray = Array.from(this.children);
                    starsArray.forEach(star => {
                        if (star.classList.contains('active')) {
                            star.style.color = '#ffc107';
                        } else {
                            star.style.color = 'var(--border-color)';
                        }
                    });
                });
            });
        }

        // استبدال وظيفة showMessage القديمة إذا كانت موجودة
        if (typeof showMessage !== 'undefined') {
            const originalShowMessage = showMessage;
            window.showMessage = function(message, type = 'info') {
                if (type === 'success' && message.includes('تقييم')) {
                    // تجاهل رسائل التقييم القديمة لأننا نستخدم الظيالوغ الجديد
                    return;
                }
                // استدعاء الوظيفة الأصلية للرسائل الأخرى
                originalShowMessage(message, type);
            };
        }
    </script>
</body>
</html>
