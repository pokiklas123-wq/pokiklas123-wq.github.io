<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>موقع المانجا</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --text-color: #333;
            --bg-color: #fff;
            --card-bg: #f8f9fa;
            --border-radius: 8px;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --primary-color: #5fa8ff;
            --secondary-color: #34495e;
            --accent-color: #ff6b6b;
            --light-color: #2c3e50;
            --dark-color: #ecf0f1;
            --text-color: #ecf0f1;
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        [data-theme="blue"] {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --text-color: #333;
            --bg-color: #f5f9ff;
            --card-bg: #e8f4ff;
            --shadow: 0 4px 6px rgba(52, 152, 219, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: var(--transition);
            min-height: 100vh;
        }

        /* Header Styles */
        header {
            background-color: var(--secondary-color);
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            text-decoration: none;
        }

        .search-container {
            flex-grow: 1;
            max-width: 500px;
            margin: 0 1rem;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            border: none;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            background-color: rgba(255, 255, 255, 0.3);
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            max-height: 300px;
            overflow-y: auto;
            z-index: 10;
            display: none;
        }

        .search-result-item {
            padding: 0.75rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .search-result-item:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .search-result-item img {
            width: 40px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            margin-left: 0.5rem;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background-color: var(--secondary-color);
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background-color: var(--primary-color);
            color: white;
        }

        /* Drawer Styles */
        .drawer {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100%;
            background-color: var(--card-bg);
            box-shadow: var(--shadow);
            transition: var(--transition);
            z-index: 1000;
            overflow-y: auto;
            padding: 1rem;
        }

        .drawer.open {
            right: 0;
        }

        .drawer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        .drawer-overlay.open {
            display: block;
        }

        .drawer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .drawer-title {
            font-size: 1.25rem;
            font-weight: bold;
        }

        .drawer-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: var(--bg-color);
            border-radius: var(--border-radius);
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-details {
            flex-grow: 1;
        }

        .user-name {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .user-email {
            font-size: 0.875rem;
            color: #666;
        }

        .drawer-menu {
            list-style: none;
            margin-bottom: 2rem;
        }

        .drawer-menu-item {
            margin-bottom: 0.5rem;
        }

        .drawer-menu-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: var(--border-radius);
            color: var(--text-color);
            text-decoration: none;
            transition: var(--transition);
        }

        .drawer-menu-link:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .drawer-menu-link i {
            width: 20px;
            text-align: center;
        }

        .theme-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .theme-option {
            flex: 1;
            padding: 0.5rem;
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            border: 1px solid rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .theme-option.active {
            background-color: var(--primary-color);
            color: white;
        }

        /* Main Content */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        .filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            border: 1px solid var(--primary-color);
            background-color: transparent;
            color: var(--primary-color);
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .filter-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        .manga-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1.5rem;
        }

        @media (max-width: 768px) {
            .manga-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }

        .manga-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
        }

        .manga-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .manga-thumbnail {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }

        .manga-info {
            padding: 1rem;
        }

        .manga-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .manga-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: #666;
        }

        .rating {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .rating i {
            color: #ffc107;
        }

        .new-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--accent-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .card-badges {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .chapter-badge {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        /* Footer */
        footer {
            background-color: var(--secondary-color);
            color: white;
            padding: 2rem 1rem;
            margin-top: 2rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .footer-section h3 {
            margin-bottom: 1rem;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 0.5rem;
        }

        .footer-links a {
            color: #ccc;
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-links a:hover {
            color: white;
        }

        .copyright {
            text-align: center;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }

        /* Loading Spinner */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ccc;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <button id="drawerToggle" class="btn btn-outline">
            <i class="fas fa-bars"></i>
        </button>
        <a href="#" class="logo">مانجا أونلاين</a>
        <div class="search-container">
            <input type="text" class="search-input" placeholder="ابحث عن مانجا...">
            <div class="search-results"></div>
        </div>
        <div class="header-actions">
            <button id="themeToggle" class="btn btn-outline">
                <i class="fas fa-moon"></i>
            </button>
            <button id="notificationsBtn" class="btn btn-outline">
                <i class="fas fa-bell"></i>
            </button>
            <button id="authBtn" class="btn">
                <i class="fas fa-user"></i>
                <span>تسجيل الدخول</span>
            </button>
        </div>
    </header>

    <!-- Drawer -->
    <div class="drawer">
        <div class="drawer-header">
            <h2 class="drawer-title">القائمة</h2>
            <button class="drawer-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div id="userInfo" class="user-info hidden">
            <img src="" alt="صورة المستخدم" class="user-avatar">
            <div class="user-details">
                <div class="user-name"></div>
                <div class="user-email"></div>
            </div>
        </div>
        
        <ul class="drawer-menu">
            <li class="drawer-menu-item">
                <a href="#" class="drawer-menu-link">
                    <i class="fas fa-home"></i>
                    <span>الصفحة الرئيسية</span>
                </a>
            </li>
            <li class="drawer-menu-item">
                <a href="#" class="drawer-menu-link">
                    <i class="fas fa-fire"></i>
                    <span>الأكثر مشاهدة</span>
                </a>
            </li>
            <li class="drawer-menu-item">
                <a href="#" class="drawer-menu-link">
                    <i class="fas fa-star"></i>
                    <span>الأعلى تقييماً</span>
                </a>
            </li>
            <li class="drawer-menu-item">
                <a href="#" class="drawer-menu-link">
                    <i class="fas fa-history"></i>
                    <span>الأحدث</span>
                </a>
            </li>
            <li class="drawer-menu-item">
                <a href="#" class="drawer-menu-link" id="notificationsDrawerBtn">
                    <i class="fas fa-bell"></i>
                    <span>الإشعارات</span>
                </a>
            </li>
        </ul>
        
        <div class="theme-selector">
            <div class="theme-option active" data-theme="light">فاتح</div>
            <div class="theme-option" data-theme="dark">مظلم</div>
            <div class="theme-option" data-theme="blue">أزرق</div>
        </div>
        
        <button id="logoutBtn" class="btn btn-outline hidden">
            <i class="fas fa-sign-out-alt"></i>
            <span>تسجيل الخروج</span>
        </button>
    </div>
    <div class="drawer-overlay"></div>

    <!-- Main Content -->
    <div class="container">
        <div class="filters">
            <button class="filter-btn active" data-filter="latest">الأحدث</button>
            <button class="filter-btn" data-filter="popular">الأكثر مشاهدة</button>
            <button class="filter-btn" data-filter="rating">الأعلى تقييماً</button>
            <button class="filter-btn" data-filter="oldest">الأقدم</button>
        </div>
        
        <div class="manga-grid" id="mangaGrid">
            <!-- سيتم ملء هذا القسم بالبيانات من Firebase -->
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>مانجا أونلاين</h3>
                <p>أفضل موقع لقراءة المانجا العربية. استمتع بأفضل القصص المصورة من مختلف الأنواع.</p>
            </div>
            <div class="footer-section">
                <h3>روابط سريعة</h3>
                <ul class="footer-links">
                    <li><a href="#">الصفحة الرئيسية</a></li>
                    <li><a href="#">المانجا الجديدة</a></li>
                    <li><a href="#">الأكثر مشاهدة</a></li>
                    <li><a href="#">الأعلى تقييماً</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>الدعم</h3>
                <ul class="footer-links">
                    <li><a href="#">اتصل بنا</a></li>
                    <li><a href="#">الأسئلة الشائعة</a></li>
                    <li><a href="#">سياسة الخصوصية</a></li>
                    <li><a href="#">شروط الاستخدام</a></li>
                </ul>
            </div>
        </div>
        <div class="copyright">
            &copy; 2023 مانجا أونلاين. جميع الحقوق محفوظة.
        </div>
    </footer>

    <script>
        // تهيئة Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBfcjTc-bfiRocYeBSmUrxid6WEVBYvVTg",
            authDomain: "pgfxtool-pro.firebaseapp.com",
            databaseURL: "https://pgfxtool-pro-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "pgfxtool-pro",
            storageBucket: "pgfxtool-pro.appspot.com",
            messagingSenderId: "1096122383871",
            appId: "1:1096122383871:android:82a42721ccff8294d33bca"
        };
        
        // تهيئة Firebase
        firebase.initializeApp(firebaseConfig);
        
        // مراجع لقاعدة البيانات والمصادقة
        const database = firebase.database();
        const auth = firebase.auth();
        
        // حالة التطبيق
        let currentUser = null;
        let mangaList = [];
        let currentFilter = 'latest';
        
        // عناصر DOM
        const drawer = document.querySelector('.drawer');
        const drawerOverlay = document.querySelector('.drawer-overlay');
        const drawerToggle = document.getElementById('drawerToggle');
        const drawerClose = document.querySelector('.drawer-close');
        const themeToggle = document.getElementById('themeToggle');
        const notificationsBtn = document.getElementById('notificationsBtn');
        const authBtn = document.getElementById('authBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const userInfo = document.getElementById('userInfo');
        const userName = document.querySelector('.user-name');
        const userEmail = document.querySelector('.user-email');
        const userAvatar = document.querySelector('.user-avatar');
        const mangaGrid = document.getElementById('mangaGrid');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const searchInput = document.querySelector('.search-input');
        const searchResults = document.querySelector('.search-results');
        const themeOptions = document.querySelectorAll('.theme-option');
        
        // فتح وإغلاق الدراور
        drawerToggle.addEventListener('click', () => {
            drawer.classList.add('open');
            drawerOverlay.classList.add('open');
        });
        
        drawerClose.addEventListener('click', closeDrawer);
        drawerOverlay.addEventListener('click', closeDrawer);
        
        function closeDrawer() {
            drawer.classList.remove('open');
            drawerOverlay.classList.remove('open');
        }
        
        // تبديل الوضع الليلي/النهاري
        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // تحديث الأيقونة
            const icon = themeToggle.querySelector('i');
            icon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        });
        
        // اختيار السمة من الدراور
        themeOptions.forEach(option => {
            option.addEventListener('click', () => {
                themeOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                
                const theme = option.getAttribute('data-theme');
                document.documentElement.setAttribute('data-theme', theme);
                localStorage.setItem('theme', theme);
                
                // تحديث الأيقونة في الهيدر
                const icon = themeToggle.querySelector('i');
                if (theme === 'dark') {
                    icon.className = 'fas fa-sun';
                } else if (theme === 'blue') {
                    icon.className = 'fas fa-palette';
                } else {
                    icon.className = 'fas fa-moon';
                }
            });
        });
        
        // تحميل السمة المحفوظة
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            // تحديث الأيقونة والأزرار
            const icon = themeToggle.querySelector('i');
            if (savedTheme === 'dark') {
                icon.className = 'fas fa-sun';
            } else if (savedTheme === 'blue') {
                icon.className = 'fas fa-palette';
            } else {
                icon.className = 'fas fa-moon';
            }
            
            themeOptions.forEach(option => {
                if (option.getAttribute('data-theme') === savedTheme) {
                    option.classList.add('active');
                } else {
                    option.classList.remove('active');
                }
            });
        }
        
        // تصفية المانجا
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                filterBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                currentFilter = btn.getAttribute('data-filter');
                displayManga(mangaList);
            });
        });
        
        // البحث عن المانجا
        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase().trim();
            
            if (query.length === 0) {
                searchResults.style.display = 'none';
                return;
            }
            
            const results = mangaList.filter(manga => 
                manga.name.toLowerCase().includes(query)
            );
            
            displaySearchResults(results);
        });
        
        function displaySearchResults(results) {
            searchResults.innerHTML = '';
            
            if (results.length === 0) {
                searchResults.style.display = 'none';
                return;
            }
            
            results.slice(0, 5).forEach(manga => {
                const item = document.createElement('div');
                item.className = 'search-result-item';
                
                item.innerHTML = `
                    <img src="${manga.thumbnail}" alt="${manga.name}">
                    <div>
                        <div>${manga.name}</div>
                        <div class="manga-meta">
                            <span>${manga.views} مشاهدة</span>
                            <span class="rating">
                                <i class="fas fa-star"></i>
                                <span>${manga.rating || 0}</span>
                            </span>
                        </div>
                    </div>
                `;
                
                item.addEventListener('click', () => {
                    window.location.href = `manga.html?id=${manga.id}`;
                });
                
                searchResults.appendChild(item);
            });
            
            searchResults.style.display = 'block';
        }
        
        // إغلاق نتائج البحث عند النقر خارجها
        document.addEventListener('click', (e) => {
            if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                searchResults.style.display = 'none';
            }
        });
        
        // تحميل بيانات المانجا من Firebase
        function loadMangaData() {
            mangaGrid.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            database.ref('manga_list').once('value')
                .then(snapshot => {
                    const data = snapshot.val();
                    mangaList = [];
                    
                    if (data) {
                        Object.keys(data).forEach(key => {
                            const manga = data[key];
                            manga.id = key;
                            mangaList.push(manga);
                        });
                    }
                    
                    displayManga(mangaList);
                })
                .catch(error => {
                    console.error('Error loading manga data:', error);
                    mangaGrid.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p>حدث خطأ في تحميل البيانات</p>
                            <button class="btn mt-2" onclick="loadMangaData()">إعادة المحاولة</button>
                        </div>
                    `;
                });
        }
        
        // عرض المانجا في الشبكة
        function displayManga(mangaArray) {
            // تطبيق التصفية
            let filteredManga = [...mangaArray];
            
            switch (currentFilter) {
                case 'latest':
                    // ترتيب حسب الأحدث (افتراضيًا حسب الترتيب في قاعدة البيانات)
                    break;
                case 'popular':
                    filteredManga.sort((a, b) => (b.views || 0) - (a.views || 0));
                    break;
                case 'rating':
                    filteredManga.sort((a, b) => (b.rating || 0) - (a.rating || 0));
                    break;
                case 'oldest':
                    // ترتيب حسب الأقدم (عكس الأحدث)
                    filteredManga.reverse();
                    break;
            }
            
            // عرض المانجا
            mangaGrid.innerHTML = '';
            
            if (filteredManga.length === 0) {
                mangaGrid.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-book-open"></i>
                        <p>لا توجد مانجا متاحة</p>
                    </div>
                `;
                return;
            }
            
            filteredManga.forEach(manga => {
                const card = document.createElement('div');
                card.className = 'manga-card';
                
                // الحصول على آخر فصل (أعلى رقم)
                let latestChapter = null;
                if (manga.chapters) {
                    const chapterNumbers = Object.keys(manga.chapters).map(key => {
                        const num = parseInt(key.replace('chapter_', ''));
                        return isNaN(num) ? 0 : num;
                    });
                    
                    if (chapterNumbers.length > 0) {
                        const maxChapter = Math.max(...chapterNumbers);
                        latestChapter = `الفصل ${maxChapter}`;
                    }
                }
                
                card.innerHTML = `
                    <div style="position: relative;">
                        <img src="${manga.thumbnail}" alt="${manga.name}" class="manga-thumbnail">
                        ${latestChapter ? `<div class="chapter-badge">${latestChapter}</div>` : ''}
                    </div>
                    <div class="manga-info">
                        <div class="manga-title">${manga.name}</div>
                        <div class="manga-meta">
                            <span>${manga.views || 0} مشاهدة</span>
                            <span class="rating">
                                <i class="fas fa-star"></i>
                                <span>${manga.rating || 0}</span>
                            </span>
                        </div>
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    window.location.href = `manga.html?id=${manga.id}`;
                });
                
                mangaGrid.appendChild(card);
            });
        }
        
        // إدارة حالة المستخدم
        auth.onAuthStateChanged(user => {
            currentUser = user;
            
            if (user) {
                // المستخدم مسجل الدخول
                authBtn.classList.add('hidden');
                logoutBtn.classList.remove('hidden');
                userInfo.classList.remove('hidden');
                
                // تحميل بيانات المستخدم
                database.ref('users/' + user.uid).once('value')
                    .then(snapshot => {
                        const userData = snapshot.val();
                        
                        if (userData) {
                            userName.textContent = userData.displayName || user.displayName || 'مستخدم';
                            userEmail.textContent = userData.email || user.email;
                            userAvatar.src = userData.profile?.avatar || 
                                `https://ui-avatars.com/api/?name=${encodeURIComponent(userData.displayName || user.displayName || 'مستخدم')}&background=4ECDC4&color=fff&size=150`;
                        }
                    })
                    .catch(error => {
                        console.error('Error loading user data:', error);
                    });
            } else {
                // المستخدم غير مسجل الدخول
                authBtn.classList.remove('hidden');
                logoutBtn.classList.add('hidden');
                userInfo.classList.add('hidden');
            }
        });
        
        // تسجيل الدخول/التسجيل
        authBtn.addEventListener('click', () => {
            window.location.href = 'auth.html';
        });
        
        // تسجيل الخروج
        logoutBtn.addEventListener('click', () => {
            auth.signOut()
                .then(() => {
                    closeDrawer();
                })
                .catch(error => {
                    console.error('Error signing out:', error);
                });
        });
        
        // الانتقال إلى صفحة الإشعارات
        notificationsBtn.addEventListener('click', () => {
            if (currentUser) {
                window.location.href = 'notifications.html';
            } else {
                window.location.href = 'auth.html';
            }
        });
        
        document.getElementById('notificationsDrawerBtn').addEventListener('click', (e) => {
            e.preventDefault();
            if (currentUser) {
                window.location.href = 'notifications.html';
            } else {
                window.location.href = 'auth.html';
            }
            closeDrawer();
        });
        
        // تحميل البيانات عند بدء التشغيل
        document.addEventListener('DOMContentLoaded', () => {
            loadMangaData();
        });
    </script>
</body>
</html>