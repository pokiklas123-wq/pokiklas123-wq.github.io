<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุจุซ ุงููุจุงุดุฑ - ุงููุฏุฑุณ</title>
    <style>
        * { box-sizing: border-box; font-family: Arial, sans-serif; }
        body { margin: 0; padding: 20px; background: #f0f2f5; }
        .container { max-width: 1200px; margin: auto; }
        
        h1 { color: #1a73e8; text-align: center; }
        
        .video-container {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            background: black;
            border-radius: 10px;
            overflow: hidden;
        }
        
        video {
            width: 100%;
            height: auto;
            max-height: 500px;
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        button {
            background: #1a73e8;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            margin: 10px;
            font-size: 18px;
            cursor: pointer;
        }
        
        button:disabled { background: #ccc; }
        
        .url-box {
            background: #e8f0fe;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            display: none;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
        }
        
        .active { background: #d4edda; color: #155724; }
        .inactive { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>๐ ุจุซ ูุจุงุดุฑ ูู ุตูุญุชู - ุงููุฏุฑุณ</h1>
        
        <div class="video-container">
            <video id="localVideo" autoplay muted></video>
        </div>
        
        <div class="controls">
            <button onclick="startBroadcast()" id="startBtn">โถ ุจุฏุก ุงูุจุซ</button>
            <button onclick="stopBroadcast()" id="stopBtn" disabled>โน ุฅููุงู ุงูุจุซ</button>
            <button onclick="toggleScreenShare()" id="screenBtn">๐ฅ๏ธ ูุดุงุฑูุฉ ุงูุดุงุดุฉ</button>
        </div>
        
        <div class="status inactive" id="status">โซ ุงูุจุซ ุบูุฑ ูุดุท</div>
        
        <div class="url-box" id="urlBox">
            <h3>๐ ุฑุงุจุท ุงููุดุงูุฏุฉ ููุทูุงุจ:</h3>
            <p id="broadcastUrl">ุฌุงุฑู ุฅูุดุงุก ุงูุฑุงุจุท...</p>
            <button onclick="copyUrl()">๐ ูุณุฎ ุงูุฑุงุจุท</button>
            <p style="color: #666; margin-top: 10px;">
                ุฃุฑุณู ูุฐุง ุงูุฑุงุจุท ููุทูุงุจ ููุดุงูุฏุฉ ุงูุจุซ ุงููุจุงุดุฑ
            </p>
        </div>
        
        <div style="background: #fff3cd; padding: 15px; border-radius: 5px; margin-top: 30px;">
            <h3>๐ฏ ููู ูุนูู:</h3>
            <p>1. ุงุถุบุท "ุจุฏุก ุงูุจุซ" โ ุณูุฃุฎุฐ ุฅุฐู ุงููุงููุฑุง ูุงููููุฑูููู</p>
            <p>2. ุงูุณุฎ ุงูุฑุงุจุท ุงูุฐู ุณูุธูุฑ โ ุฃุฑุณูู ููุทูุงุจ</p>
            <p>3. ุงุถุบุท "ูุดุงุฑูุฉ ุงูุดุงุดุฉ" ูุนุฑุถ ุดุงุดุชู ุจุฏู ุงููุงููุฑุง</p>
            <p>4. ุชุญุฏุซ ุจุดูู ุทุจูุนู โ ุงูุทูุงุจ ุณูุดุงูุฏูู ููุณูุนูู</p>
        </div>
    </div>

    <script>
        let localStream;
        let peerConnection;
        let isBroadcasting = false;
        let broadcastUrl = '';
        let isScreenSharing = false;
        
        // ุฅุนุฏุงุฏุงุช WebRTC ุจุณูุทุฉ
        const configuration = {
            iceServers: [
                { urls: 'stun:stun.l.google.com:19302' },
                { urls: 'stun:stun1.l.google.com:19302' }
            ]
        };
        
        // ุฅูุดุงุก ูุนุฑู ูุฑูุฏ ููุจุซ
        function generateBroadcastId() {
            return 'broadcast_' + Math.random().toString(36).substr(2, 9);
        }
        
        async function startBroadcast() {
            try {
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
                
                // ุทูุจ ุฅุฐู ุงููุงููุฑุง ูุงููููุฑูููู
                localStream = await navigator.mediaDevices.getUserMedia({
                    video: true,
                    audio: true
                });
                
                // ุนุฑุถ ุงูููุฏูู ุงููุญูู
                document.getElementById('localVideo').srcObject = localStream;
                
                // ุฅูุดุงุก ุงุชุตุงู WebRTC
                peerConnection = new RTCPeerConnection(configuration);
                
                // ุฅุถุงูุฉ ุงูุชุฏูู ุงููุญูู
                localStream.getTracks().forEach(track => {
                    peerConnection.addTrack(track, localStream);
                });
                
                // ุฅูุดุงุก ุงูุนุฑุถ
                const offer = await peerConnection.createOffer();
                await peerConnection.setLocalDescription(offer);
                
                // ุชูููุฏ ุฑุงุจุท ุงูุจุซ
                const broadcastId = generateBroadcastId();
                const currentUrl = window.location.origin + window.location.pathname;
                const studentUrl = currentUrl.replace('teacher.html', '') + 'student.html?id=' + broadcastId;
                
                broadcastUrl = studentUrl;
                
                // ุญูุธ ุงูุนุฑุถ ูู localStorage (ูุญุงูุงุฉ ููุฎุงุฏู)
                localStorage.setItem('broadcast_offer_' + broadcastId, JSON.stringify(offer));
                
                // ุนุฑุถ ุฑุงุจุท ุงูุทูุงุจ
                document.getElementById('broadcastUrl').textContent = studentUrl;
                document.getElementById('urlBox').style.display = 'block';
                
                // ุชุญุฏูุซ ุงูุญุงูุฉ
                isBroadcasting = true;
                document.getElementById('status').className = 'status active';
                document.getElementById('status').textContent = '๐ข ุงูุจุซ ูุดุท - ุฌุงุฑู ุงูุฅุฑุณุงู';
                
                console.log('โ ุงูุจุซ ุจุฏุฃ! ุงูุฑุงุจุท:', studentUrl);
                
            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุจุฏุก ุงูุจุซ:', error);
                alert('โ ุฎุทุฃ: ' + error.message);
                stopBroadcast();
            }
        }
        
        function stopBroadcast() {
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
            }
            if (peerConnection) {
                peerConnection.close();
            }
            
            isBroadcasting = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('status').className = 'status inactive';
            document.getElementById('status').textContent = 'โซ ุงูุจุซ ูุชููู';
            
            document.getElementById('localVideo').srcObject = null;
            
            console.log('โน๏ธ ุงูุจุซ ุชููู');
        }
        
        async function toggleScreenShare() {
            try {
                if (isScreenSharing) {
                    // ุงูุนูุฏุฉ ูููุงููุฑุง
                    const stream = await navigator.mediaDevices.getUserMedia({
                        video: true,
                        audio: true
                    });
                    
                    // ุงุณุชุจุฏุงู ุงูุชุฏูู
                    localStream.getTracks().forEach(track => track.stop());
                    localStream = stream;
                    
                    document.getElementById('localVideo').srcObject = localStream;
                    isScreenSharing = false;
                    document.getElementById('screenBtn').textContent = '๐ฅ๏ธ ูุดุงุฑูุฉ ุงูุดุงุดุฉ';
                    
                } else {
                    // ูุดุงุฑูุฉ ุงูุดุงุดุฉ
                    const stream = await navigator.mediaDevices.getDisplayMedia({
                        video: true,
                        audio: true
                    });
                    
                    // ุงุณุชุจุฏุงู ุงูุชุฏูู
                    localStream.getTracks().forEach(track => track.stop());
                    localStream = stream;
                    
                    document.getElementById('localVideo').srcObject = localStream;
                    isScreenSharing = true;
                    document.getElementById('screenBtn').textContent = '๐ท ุงูุนูุฏุฉ ูููุงููุฑุง';
                }
                
            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ูุดุงุฑูุฉ ุงูุดุงุดุฉ:', error);
            }
        }
        
        function copyUrl() {
            navigator.clipboard.writeText(broadcastUrl).then(() => {
                alert('โ ุชู ูุณุฎ ุฑุงุจุท ุงูุจุซ!');
            });
        }
        
        // ุฅุบูุงู ุงูุจุซ ุนูุฏ ูุบุงุฏุฑุฉ ุงูุตูุญุฉ
        window.addEventListener('beforeunload', () => {
            if (isBroadcasting) {
                stopBroadcast();
            }
        });
    </script>
</body>
</html>
