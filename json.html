<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Download API - JSON Output</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .loading {
            color: #569cd6;
        }
        .error {
            color: #f44747;
        }
    </style>
</head>
<body>
    <pre id="json-output"></pre>

    <script>
        // دالة لاستخراج معلمات URL
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        // التحقق من صيغة رابط يوتيوب
        function isValidYouTubeUrl(url) {
            const pattern = /^(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
            return pattern.test(url);
        }

        async function fetchVideoData() {
            const urlParam = getUrlParameter('url');
            const output = document.getElementById('json-output');

            if (!urlParam) {
                output.innerHTML = `<span class="error">{"error": "يجب تقديم معلمة URL", "code": 400}</span>`;
                return;
            }

            // تنظيف الرابط من أي معلمات إضافية
            const cleanUrl = urlParam.split('?')[0];

            if (!isValidYouTubeUrl(cleanUrl)) {
                output.innerHTML = `<span class="error">{"error": "رابط يوتيوب غير صالح", "code": 400}</span>`;
                return;
            }

            try {
                output.innerHTML = `<span class="loading">جاري جلب بيانات الفيديو...</span>`;
                
                const apiUrl = `https://api.vidfly.ai/api/media/youtube/download?url=${encodeURIComponent(cleanUrl)}`;
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    throw new Error(`خطأ في الخادم: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.code !== 0) {
                    throw new Error('فشل في جلب بيانات الفيديو');
                }

                // عرض البيانات كـ JSON
                output.innerHTML = JSON.stringify(data, null, 2);
                
            } catch (error) {
                console.error('Error:', error);
                output.innerHTML = `<span class="error">${JSON.stringify({error: error.message, code: 500}, null, 2)}</span>`;
            }
        }

        // تشغيل الدالة عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', fetchVideoData);
    </script>
</body>
</html>
